<!DOCTYPE html>
<!--
Here comes the text of your license
Each line should be prefixed with 
-->
<html>
    <head>
        <title>isoSnake</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="../iwe.js"></script>
    </head>
    <body>
        <center> 
        <canvas id="c" width="1140" height="740" style="border: 2px solid orange;">Váš prohlížeč bohužel tuto technologii nepodporuje, porsím aktualizujte jej</canvas>
        <br>Points: <input type="text" id="score" size="2">
        </center>>
        <script type="text/javascript">
            iwe.INIT({
                canvas: 'c',
                imagesDir: '../images/',
                images: [   'grass_1.png','rocks.png', //0,1
                            'head_right.png','head_down.png','head_up.png','head_left.png',//2,3,4,5
                            'segment_right.png','segment_down.png','segment_up.png','segment_left.png',//6,7,8,9
                            'tile_right.png','tile_down.png','tile_up.png','tile_rleft.png', //10,11,12,13
                            'apple.png','apple2.png',], //14,15
                map: [
                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
                        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
                     ],
                 startMapAt: {x: 530, y: 10}
            });
            iwe.Tiles.t0 ={
                spriteId: 0,
                offset: {x: 0, y: 0},
                walkable: true
            };
            iwe.Tiles.t1 = {
                spriteId: 1,
                offset: {x: 0, y: 15},
                walkable: false
            };
            iwe.Tiles.t2 = {
                spriteId: 15,
                offset: {x: -7, y: 25},
                walkable: true
            };
            
            
            var SNAKE = {
                body: [],
                speed: 150, //ms on one tile
                direction: 'right',
                moving: false,
                points: 0,
                eatSound: new Audio("../sounds/eat.mp3")
                
            };
            var FOOD = { //first piece will look like this
                x: 5,
                y: 5,
                points: 1,
                spriteId: 14,
                offset: {
                    x: 7,
                    y: -25
                }
            };
            function cSegment(x,y,sprite,direction){
                this.spriteId = sprite;
                this.x = x;
                this.y = y;
                this.offset = {x: 0, y: -30};
                this.direction = direction;
            } 
            /*cSegment.prototype.spriteId = 6;
            cSegment.prototype.direction = 'right';
            alert(new cSegment(1,1).spriteId);*/
            
            function pushSnake (){
                for(var i = 0; i <= SNAKE.body.length-1; i++){
                    var segment = SNAKE.body[i];
                    var coor = iwe.TRANSFORM.toIso(segment.x, segment.y);
                    coor.x += segment.offset.x;
                    coor.y += segment.offset.y;
                    iwe.DRAW.image(iwe.images[segment.spriteId],coor.x,coor.y);
                    
                }
            }
            function pushFood (){
                var coor = iwe.TRANSFORM.toIso(FOOD.x, FOOD.y);
                coor.x += FOOD.offset.x;
                coor.y += FOOD.offset.y;
                iwe.DRAW.image(iwe.images[FOOD.spriteId],coor.x,coor.y); 
                console.log(iwe.images[FOOD.spriteId]);
            }
            window.onkeydown = function(e){ //this changing direction of snakes moves
                        if (e.keyCode === 38) {         //up
                            if (SNAKE.direction !== "down" && SNAKE.moving) {
                                SNAKE.moving = false;
                                SNAKE.direction = "up";
                                console.log("Turning up");
                            } 
                        } else if (e.keyCode === 40) { //down
                            if (SNAKE.direction !== "up" && SNAKE.moving) {
                                SNAKE.moving = false;
                                SNAKE.direction = "down";
                                console.log("Turning down");
                            }
                        } else if (e.keyCode === 37) { //left
                            if (SNAKE.direction !== "right" && SNAKE.moving) {
                                SNAKE.moving = false;
                                SNAKE.direction = "left";
                                console.log("Turning left");
                            }
                        } else if (e.keyCode === 39) { //right
                            if (SNAKE.direction !== "left" && SNAKE.moving) {
                                SNAKE.moving = false;
                                SNAKE.direction = "right";
                                console.log("Turning right");
                            }
                        }
                };
                
            function moveSnake(){
                for(var i = 0; i <= SNAKE.body.length-2; i++){
                    SNAKE.body[i].x = SNAKE.body[i+1].x;
                    SNAKE.body[i].y = SNAKE.body[i+1].y;
                    //SNAKE.body[i].spriteId = SNAKE.body[i+1].spriteId;
                }
                var head = SNAKE.body[SNAKE.body.length-1];
                if (SNAKE.direction === "left") {
                    //iwe.Map.offset.x += 26;
                    //iwe.Map.offset.y += 15;
                    head.x --;
                    head.spriteId = 5;
                    head.offset.y = -36;
                }
                if (SNAKE.direction === "right") {
                    //iwe.Map.offset.x -= 26;
                    //iwe.Map.offset.y -= 15;                    
                    head.x ++;
                    head.spriteId = 2;
                    head.offset.y = -30;
                }
                if (SNAKE.direction === "up") {
                  //iwe.Map.offset.x -= 26;
                  //iwe.Map.offset.y += 15;
                  head.y --;
                  head.spriteId = 4;
                  head.offset.y = -36;
                }
                if (SNAKE.direction === "down") {
                  //iwe.Map.offset.x += 26;
                  //iwe.Map.offset.y -= 15;                  
                  head.y ++;
                  head.spriteId = 3;
                  head.offset.y = -30;
                }
                if (iwe.getTile(head.x,head.y) === 1){
                    clearInterval(interval);
                    //alert("GAME OVER\nYou crashed the wall!");
                    
                }
                if (iwe.getTile(head.x, head.y) === 2){
                    iwe.loadMap([
                            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
                            ], iwe.Map.offset.x, iwe.Map.offset.y);
                   head.x = 2;
                   head.y = 2;
                }
                for(var i = 0; i <= SNAKE.body.length-2; i++){
                        if(head.x === SNAKE.body[i].x && head.y === SNAKE.body[i].y){
                           // alert("GAME OVER\nYou crashed into your own tail!");
                            clearInterval(interval);
                        }
                }
                if(head.x === FOOD.x && head.y === FOOD.y){
                    //alert('YES, you got it');
                    SNAKE.points += FOOD.points;
                    SNAKE.body.unshift(new cSegment(SNAKE.body[0].x-1,SNAKE.body[0].y,6));
                    FOOD.x = Math.floor(Math.random() * 18) + 1;
                    FOOD.y = Math.floor(Math.random() * 18) + 1;
                    FOOD.spriteId = 15;
                    document.getElementById('score').value = SNAKE.points;
                    SNAKE.eatSound.play();
                }
                SNAKE.moving = true;
                pushSnake();
            }
            function draw(){
                iwe.CLEAR();
                iwe.DRAW.all();
                moveSnake();
                pushSnake();
                pushFood();
            }
            
        
            
            SNAKE.body = [
             new cSegment(1,3,6),
             new cSegment(2,3,6),
             new cSegment(3,3,6),
             new cSegment(4,3,6),
             new cSegment(5,3,2)
             ];
   
         var interval = setInterval(function(){
                draw();
                console.log(SNAKE.direction+'; '+SNAKE.body[1].x);
            }, SNAKE.speed);    
    

  
             
             //iwe.DRAW.all();
             //pushSnake();
        </script>
    </body>
</html>
